<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <title>{{ page.title | default: site.title }}</title>
  <link rel="stylesheet" href="/styles/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  </head>
  <body>
    {% include header.html %}
    <main>
      {{ content }}
    </main>
    {% include footer.html %}
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- PDF.js para análise de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- JSZip para arquivos compactados -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- EmailJS para envio de emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- 🛡️ Sistema inteligente de carregamento de JavaScript -->
    <script>
    (function() {
        // Detecta ambiente
        const isLocal = window.location.hostname === 'localhost' ||
                       window.location.hostname === '127.0.0.1' ||
                       window.location.hostname === '' ||
                       window.location.protocol === 'file:' ||
                       window.location.port !== '';

        const isDev = isLocal && (
            window.location.search.includes('dev=true') ||
            localStorage.getItem('thothandson_dev_mode') === 'true'
        );

        function loadScript(src, onSuccess, onError) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    if (onSuccess) onSuccess();
                    resolve();
                };
                script.onerror = () => {
                    if (onError) onError();
                    reject();
                };
                document.head.appendChild(script);
            });
        }

        async function loadMainScript() {
            if (isDev) {
                try {
                    await loadScript('/js/src/main.js');
                } catch {
                    await loadScript('/js/main.js');
                }
            } else {
                await loadScript('/js/main.js');
            }
        }

        // Carrega quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadMainScript);
        } else {
            loadMainScript();
        }

        // Debug helper (console)
        window.switchToDevMode = function() {
            localStorage.setItem('thothandson_dev_mode', 'true');
        };

        window.switchToProdMode = function() {
            localStorage.removeItem('thothandson_dev_mode');
        };
    })();
    </script>
  </body>
</html>
